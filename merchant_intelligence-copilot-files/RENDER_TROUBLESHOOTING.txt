RENDER DEPLOYMENT TROUBLESHOOTING
==================================

ERROR: "gunicorn: command not found"
-------------------------------------

CAUSE:
Render is not finding gunicorn after installation.

SOLUTIONS:

SOLUTION 1 - Manual Configuration (Recommended):
1. In Render dashboard, go to your service
2. Click "Settings"
3. Under "Build & Deploy":
   - Build Command: pip install --upgrade pip && pip install -r requirements.txt
   - Start Command: python -m gunicorn app:app --bind 0.0.0.0:$PORT
4. Save changes
5. Trigger manual deploy

SOLUTION 2 - Use Python Module:
Update Procfile to:
web: python -m gunicorn app:app --bind 0.0.0.0:$PORT

SOLUTION 3 - Verify Root Directory:
1. In Render dashboard > Settings
2. Check "Root Directory" is set to: backend
   (or merchant-intelligence-copilot-files/backend if monorepo)
3. Ensure requirements.txt is in that directory
4. Redeploy

SOLUTION 4 - Use build.sh:
The build.sh script is included. Render should run it automatically.
If not, manually set:
- Build Command: bash build.sh

SOLUTION 5 - Alternative to Gunicorn:
If gunicorn continues to fail, use Flask's built-in server:

Update Procfile to:
web: python app.py

Update app.py (already configured):
if __name__ == '__main__':
    port = int(os.environ.get('PORT', 8000))
    app.run(host='0.0.0.0', port=port)

Note: Flask's built-in server works but gunicorn is better for production.

VERIFICATION STEPS:
-------------------
1. Check Render build logs for:
   - "Successfully installed gunicorn"
   - Any error messages during pip install

2. Check if requirements.txt is being read:
   - Look for "Collecting flask" in logs
   - Verify all packages install

3. Check Python version:
   - Should be Python 3.12
   - Verify in runtime.txt

COMMON ISSUES:
--------------

Issue: Wrong directory
Fix: Set Root Directory to backend/ in Render settings

Issue: requirements.txt not found
Fix: Ensure requirements.txt is in root of backend/

Issue: Python version mismatch
Fix: Check runtime.txt has python-3.12.0

Issue: Build succeeds but start fails
Fix: Use python -m gunicorn or python app.py

MANUAL DEPLOYMENT STEPS:
-------------------------
If automatic deployment fails:

1. Delete the service in Render
2. Create new Web Service
3. Configure manually:
   - Name: merchant-copilot-api
   - Environment: Python 3
   - Root Directory: backend (or full path if monorepo)
   - Build Command: pip install -r requirements.txt
   - Start Command: python -m gunicorn app:app --bind 0.0.0.0:$PORT
   - Python Version: 3.12

4. Add environment variables:
   - AWS_ACCESS_KEY_ID
   - AWS_SECRET_ACCESS_KEY
   - AWS_REGION

5. Deploy

TESTING LOCALLY:
----------------
Before deploying, test locally:

cd backend
pip install -r requirements.txt
gunicorn app:app --bind 0.0.0.0:8000

If this works locally but fails on Render, it's a Render configuration issue.

ALTERNATIVE START COMMANDS:
----------------------------
Try these in order if gunicorn fails:

1. python -m gunicorn app:app --bind 0.0.0.0:$PORT
2. python app.py
3. flask run --host=0.0.0.0 --port=$PORT
4. gunicorn --pythonpath . app:app --bind 0.0.0.0:$PORT

RENDER SUPPORT:
---------------
If none of these work:
1. Check Render status page
2. Review full build logs
3. Contact Render support with logs
4. Try deploying a simple Flask app first to verify account works

QUICK FIX:
----------
The fastest fix right now:

1. Go to Render dashboard
2. Settings > Build & Deploy
3. Start Command: python app.py
4. Save and redeploy

This uses Flask's built-in server which is fine for low-traffic apps.

For production with more traffic, use gunicorn with:
Start Command: python -m gunicorn app:app --bind 0.0.0.0:$PORT --workers 2

CURRENT FILES:
--------------
✓ requirements.txt - Has gunicorn==21.2.0
✓ Procfile - Has start command
✓ runtime.txt - Has python-3.12.0
✓ build.sh - Build script
✓ app.py - Flask app with fallback

All files are correct. Issue is likely Render configuration.

NEXT STEPS:
-----------
1. Try SOLUTION 1 (Manual Configuration) first
2. If that fails, try SOLUTION 2 (Python Module)
3. If still failing, use QUICK FIX (python app.py)
4. Check this guide for other solutions

The app WILL work - it's just a matter of finding the right start command for your Render setup.
